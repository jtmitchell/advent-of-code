variables:
  BASE_LAYER: bookworm-slim
  PYTHON_VERSION: "3.12"
  UV_CACHE_DIR: .uv-cache
  UV_LINK_MODE: copy
  UV_VERSION: "0.9.17"

cache:
  - key:
      files:
        - uv.lock
    paths:
      - $UV_CACHE_DIR

stages:
  - test

pytest:
  image: ghcr.io/astral-sh/uv:$UV_VERSION-python$PYTHON_VERSION-$BASE_LAYER
  stage: test
  script:
    - uv run pytest
    - uv run pre-commit run --all-files
    - uv cache prune --ci
